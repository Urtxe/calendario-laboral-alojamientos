<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Balance Laboral</title>
    <style>
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .config-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .config-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .config-card label {
            display: block;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .config-card input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border 0.3s;
        }

        .config-card input:focus {
            outline: none;
            border-color: #667eea;
        }

        .config-card .counter {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            text-align: center;
        }

        .calendar-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .calendar-header button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }

        .calendar-header button:hover {
            background: #5568d3;
        }

        .calendar-header h2 {
            color: #333;
            font-size: 1.8em;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .day-header {
            text-align: center;
            font-weight: bold;
            color: #666;
            padding: 10px;
        }

        .day-cell {
            aspect-ratio: 1;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            min-height: 60px;
        }

        .day-cell:hover {
            background: #f5f5f5;
            transform: scale(1.05);
        }

        .day-cell.selected {
            border-color: #667eea;
            border-width: 3px;
            transform: scale(1.1);
        }

        .day-cell.festivo {
            background: #fff9c4;
        }

        .day-cell.trabajado {
            background: #4caf50;
            color: white;
        }

        .day-cell.fiesta {
            background: #2196f3;
            color: white;
        }

        .day-cell.vacacion {
            background: #9c27b0;
            color: white;
        }

        .day-cell.abonable {
            background: #ff9800;
            color: white;
        }

        .day-cell.baja {
            background: #f44336;
            color: white;
        }

        .day-cell .emoji {
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 12px;
        }

        .day-number {
            font-weight: bold;
            font-size: 1.2em;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 8px;
        }

        .action-buttons button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            color: white;
            font-weight: bold;
            transition: opacity 0.3s;
        }

        .action-buttons button:hover {
            opacity: 0.9;
        }

        .btn-trabajado { background: #4caf50; }
        .btn-fiesta { background: #2196f3; }
        .btn-vacacion { background: #9c27b0; }
        .btn-abonable { background: #ff9800; }
        .btn-baja { background: #f44336; }

        .btn-limpiar { background: #fff201; /* Un rojo oscuro */
    /* Opcional: que ocupe toda la fila si quieres que est√© separado */
    /* flex-basis: 100%; 
    margin-top: 10px; */
}

        .balance-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .balance-container h2 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-card.blue { background: #e3f2fd; }
        .stat-card.purple { background: #f3e5f5; }
        .stat-card.green { background: #e8f5e9; }
        .stat-card.orange { background: #fff3e0; }

        .stat-label {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
        }

        .stat-card.blue .stat-value { color: #2196f3; }
        .stat-card.purple .stat-value { color: #9c27b0; }
        .stat-card.green .stat-value { color: #4caf50; }
        .stat-card.orange .stat-value { color: #ff9800; }

        .balance-result {
            padding: 30px;
            border-radius: 12px;
            text-align: center;
        }

        .balance-result.positive {
            background: linear-gradient(135deg, #81c784 0%, #4caf50 100%);
            color: white;
        }

        .balance-result.negative {
            background: linear-gradient(135deg, #e57373 0%, #f44336 100%);
            color: white;
        }

        .balance-hours {
            font-size: 3em;
            font-weight: bold;
            margin: 10px 0;
        }

        .balance-days {
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .balance-message {
            font-size: 1.2em;
        }

        footer {
  text-align: center;
  padding: 20px;
  background-color: #f5f5f5;
  color: #333;
  margin-top: 30px; /* Para separarlo del contenido de arriba */
  border-radius: 15px; /* Para que coincida con el estilo de tus tarjetas */
  box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}

footer p {
  margin: 5px 0; /* Un poco de espacio entre las dos l√≠neas */
}

/* --- CSS RESPONSIVO PARA M√ìVILES (Optimizado para 390px) --- */

@media (max-width: 600px) {
    body {
        padding: 5px; /* Menos padding general */
    }
    
    h1 {
        font-size: 1.8em; /* T√≠tulo m√°s peque√±o */
        margin-bottom: 20px;
    }

    .config-panel {
        gap: 10px;
    }

    .config-card {
        padding: 15px;
    }

    .calendar-container {
        padding: 5px; /* Padding del calendario muy reducido */
    }

    .calendar-header h2 {
        font-size: 1.3em; /* 'Enero 2025' m√°s peque√±o */
    }

    .calendar-header button {
        padding: 8px 10px; /* Botones 'Ant/Sig' m√°s peque√±os */
        font-size: 12px;
    }

    /* ESTA ES LA PARTE IMPORTANTE (Ajustada para 390px) */
    .calendar-grid {
        gap: 2px; /* Espacio entre d√≠as m√≠nimo */
    }
    
    .day-header {
        padding: 4px; /* Menos padding en L, M, X... */
        font-size: 0.8em; /* Letras 'L, M, X...' m√°s peque√±as */
    }

    .day-cell {
        min-height: 40px; /* Cuadrados del d√≠a m√°s bajos */
    }

    .day-number {
        font-size: 0.85em; /* N√∫meros del d√≠a m√°s peque√±os */
    }

    .day-cell .emoji {
        font-size: 8px; /* Emoji diminuto */
    }
    /* FIN DE LA PARTE IMPORTANTE */

    .action-buttons {
        gap: 5px; /* Botones de acci√≥n m√°s juntos */
    }

    .action-buttons button {
        padding: 8px 10px; /* Botones de acci√≥n m√°s peque√±os */
        font-size: 12px; /* Texto de botones m√°s peque√±o */
    }

    .stats-grid {
        gap: 10px;
    }

    .stat-card {
        padding: 10px;
    }

    .stat-label {
        font-size: 0.8em;
    }

    .stat-value {
        font-size: 1.5em;
    }
    
    .balance-container {
        padding: 10px;
    }

    .balance-hours {
        font-size: 2em;
    }
    .balance-days {
        font-size: 1.3em;
    }

    footer {
        padding: 15px;
        font-size: 0.8em;
    }
}

    </style>
    
</head>
<body>
    <div class="container">
        <h1>Calculadora de Balance Laboral</h1>

        <div class="config-panel">
            <div class="config-card">
                <label>D√≠as del a√±o
                <input type="number" id="diasAnuales" value="365"></label>
            </div>
            <div class="config-card">
                <label>Horas anuales requeridas
                <input type="number" id="horasAnuales" value="1723"></label>
            </div>
            <div class="config-card">
                <label>Festivos trabajados</label>
                <div class="counter" id="festivosTrabajados">0</div>
            </div>
        </div>

        <div class="calendar-container">
            <div class="calendar-header">
                <button onclick="cambiarMes(-1)">Anterior</button>
                <h2 id="mesAnio"></h2>
                <button onclick="cambiarMes(1)">Siguiente</button>
            </div>

            <div class="calendar-grid">
                <div class="day-header">L</div>
                <div class="day-header">M</div>
                <div class="day-header">X</div>
                <div class="day-header">J</div>
                <div class="day-header">V</div>
                <div class="day-header">S</div>
                <div class="day-header">D</div>
            </div>

            <div class="calendar-grid" id="calendario"></div>

            <div class="action-buttons" id="actionButtons">
                <button class="btn-trabajado" onclick="seleccionarModo('trabajado')">üíº Trabajado</button>
                <button class="btn-fiesta" onclick="seleccionarModo('fiesta')">üìÖ Fiesta</button>
                <button class="btn-vacacion" onclick="seleccionarModo('vacacion')">üèñÔ∏è Vacaci√≥n</button>
                <button class="btn-abonable" onclick="seleccionarModo('abonable')">üè† Abonable</button>
                <button class="btn-baja" onclick="seleccionarModo('baja')">üè• Baja</button>

                <button class="btn-limpiar" onclick="limpiarCalendario()">üßπ Resetear</button>
            </div>
        </div>

        <div class="balance-container">
            <h2>Balance Laboral</h2>
            
            <div class="stats-grid">
                <div class="stat-card blue">
                    <div class="stat-label">D√≠as trabajados</div>
                    <div class="stat-value" id="diasTrabajados">0</div>
                </div>
                <div class="stat-card purple">
                    <div class="stat-label">D√≠as de fiesta</div>
                    <div class="stat-value" id="diasFiesta">0</div>
                </div>
                <div class="stat-card green">
                    <div class="stat-label">Horas trabajadas</div>
                    <div class="stat-value" id="horasTrabajadas">0h</div>
                </div>
                <div class="stat-card orange">
                    <div class="stat-label">Horas requeridas</div>
                    <div class="stat-value" id="horasRequeridas">0h</div>
                </div>
            </div>

            <div class="balance-result positive" id="balanceResult">
                <div class="balance-label">Balance Final</div>
                <div class="balance-hours" id="balanceHoras">+0 horas</div>
                <div class="balance-days" id="balanceDias">+0 d√≠as</div>
                <div class="balance-message" id="balanceMensaje">Perfecto balance</div>
            </div>
        </div>
    </div>

<script>
    var festivosDonosti = {
    2025: [
        '2025-01-01', '2025-01-06', '2025-01-20', '2025-04-18', '2025-04-21',
        '2025-04-17', '2025-05-01', '2025-07-25', '2025-07-29', '2025-07-31',
        '2025-08-15', '2025-11-01', '2025-12-06', '2025-12-08', '2025-12-25'
    ]
};

var mesActual = new Date().getMonth();
var anioActual = new Date().getFullYear();
var diasMarcados = {};

// --- CAMBIO ---
// 'diaSeleccionado' ya no es necesario.
// 'modoSeleccionado' guardar√° la acci√≥n elegida (ej: 'fiesta', 'vacacion').
// Si es 'null', la acci√≥n por defecto ser√° 'trabajado'.
var modoSeleccionado = null; 

var dataGuardada = localStorage.getItem('misDiasMarcados');
if (dataGuardada) {
    diasMarcados = JSON.parse(dataGuardada);
}

var nombresMeses = [
    'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
    'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
];

function getFechaKey(fecha) {
    var anio = fecha.getFullYear();
    var mes = (fecha.getMonth() + 1).toString().padStart(2, '0');
    var dia = fecha.getDate().toString().padStart(2, '0');
    return anio + '-' + mes + '-' + dia;
}

function esFestivo(fecha) {
    var fechaStr = getFechaKey(fecha);
    var festivos = festivosDonosti[fecha.getFullYear()];
    return festivos ? festivos.indexOf(fechaStr) !== -1 : false;
}

function renderCalendario() {
    var calendario = document.getElementById('calendario');
    calendario.innerHTML = '';

    var primerDia = new Date(anioActual, mesActual, 1).getDay();
    var diasMes = new Date(anioActual, mesActual + 1, 0).getDate();
    var primerDiaSemana = primerDia === 0 ? 6 : primerDia - 1;

    for (var i = 0; i < primerDiaSemana; i++) {
        var vacio = document.createElement('div');
        calendario.appendChild(vacio);
    }

    for (var dia = 1; dia <= diasMes; dia++) {
        var fecha = new Date(anioActual, mesActual, dia);
        var fechaKey = getFechaKey(fecha);
        var marcado = diasMarcados[fechaKey];
        var festivo = esFestivo(fecha);

        var celda = document.createElement('div');
        celda.className = 'day-cell';
        celda.innerHTML = '<span class="day-number">' + dia + '</span>';

        if (marcado) {
            celda.classList.add(marcado.tipo);
            if (marcado.esFestivo) {
                celda.innerHTML += '<span class="emoji">üéâ</span>';
            }
        } else if (festivo) {
            celda.classList.add('festivo');
            celda.innerHTML += '<span class="emoji">üéâ</span>';
        }

        // --- CAMBIO ---
        // Ya no usamos la clase 'selected'
        
        // --- CAMBIO ---
        // El clic en la celda ahora llama a 'procesarClickDia'
        celda.onclick = (function(d) {
            return function() { procesarClickDia(d); };
        })(dia);
        
        calendario.appendChild(celda);
    }

    document.getElementById('mesAnio').textContent = nombresMeses[mesActual] + ' ' + anioActual;
}

// --- FUNCI√ìN NUEVA ---
// Se llama al hacer clic en un bot√≥n de acci√≥n (ej: 'Fiesta')
function seleccionarModo(tipo) {
    // Si pulsamos el mismo bot√≥n otra vez, lo desactivamos (volvemos al modo 'trabajado' por defecto)
    if (modoSeleccionado === tipo) {
        modoSeleccionado = null;
    } else {
        modoSeleccionado = tipo;
    }
    // Actualizamos el estilo de los botones para saber cu√°l est√° activo
    actualizarVisualBotones();
}

// --- FUNCI√ìN NUEVA ---
// A√±ade un borde al bot√≥n que est√° activo para que el usuario lo sepa
function actualizarVisualBotones() {
    var botones = document.querySelectorAll('.action-buttons button');
    botones.forEach(function(btn) {
        var tipoBoton = null;
        // Extraemos el tipo (ej: de 'btn-fiesta' saca 'fiesta')
        btn.classList.forEach(function(clase) {
            if (clase.startsWith('btn-')) {
                tipoBoton = clase.replace('btn-', '');
            }
        });

        if (tipoBoton && tipoBoton === modoSeleccionado) {
            // Estilo para el bot√≥n activo
            btn.style.outline = '3px solid #333';
            btn.style.transform = 'scale(1.05)';
        } else {
            // Estilo para botones inactivos
            btn.style.outline = 'none';
            btn.style.transform = 'scale(1)';
        }
    });
}

// --- FUNCI√ìN NUEVA ---
// Esta funci√≥n reemplaza a 'seleccionarDia' y 'marcarDia'
// Se ejecuta CADA VEZ que se hace clic en un d√≠a del calendario
function procesarClickDia(dia) {
    // 1. Decide qu√© tipo aplicar
    // Si hay un modo seleccionado (fiesta, vacacion, etc.), se usa ese.
    // Si 'modoSeleccionado' es 'null', se usa el modo por defecto: 'trabajado'.
    var tipoParaAplicar = modoSeleccionado;
    if (tipoParaAplicar === null) {
        tipoParaAplicar = 'trabajado';
    }

    // 2. Obtiene los datos del d√≠a (como hac√≠a 'marcarDia')
    var fecha = new Date(anioActual, mesActual, dia);
    var fechaKey = getFechaKey(fecha);
    var yaEsFestivo = esFestivo(fecha);

    // 3. Aplica o quita la marca (l√≥gica de 'toggle')
    if (diasMarcados[fechaKey] && diasMarcados[fechaKey].tipo === tipoParaAplicar) {
        // Si ya estaba marcado con este tipo, lo borra
        delete diasMarcados[fechaKey];
    } else {
        // Si no, lo marca
        diasMarcados[fechaKey] = { tipo: tipoParaAplicar, esFestivo: yaEsFestivo };
    }

    // 4. Actualiza todo
    renderCalendario();
    calcularBalance();
    guardarDatos();
}


function cambiarMes(direccion) {
    mesActual += direccion;
    if (mesActual > 11) {
        mesActual = 0;
        anioActual++;
    } else if (mesActual < 0) {
        mesActual = 11;
        anioActual--;
    }
    // --- CAMBIO ---
    // Ya no necesitamos resetear 'diaSeleccionado' ni ocultar los botones
    renderCalendario();
}

function guardarDatos() {
    localStorage.setItem('misDiasMarcados', JSON.stringify(diasMarcados));
}

function limpiarCalendario() {
    // Pedimos confirmaci√≥n para una acci√≥n destructiva
    var confirmacion = confirm("¬øEst√°s seguro de que quieres borrar todos los d√≠as marcados? Esta acci√≥n no se puede deshacer.");

    if (confirmacion) {
        // 1. Borra todos los datos
        diasMarcados = {};
        
        // 2. Resetea el modo seleccionado
        modoSeleccionado = null;
        
        // 3. Guarda el estado vac√≠o
        guardarDatos();
        
        // 4. Actualiza la vista
        renderCalendario();
        calcularBalance();
        actualizarVisualBotones();
    }
}

function calcularBalance() {
    var horasTrabajadas = 0;
    var horasRequeridas = parseInt(document.getElementById('horasAnuales').value);
    var diasTrabajados = 0;
    var diasFiesta = 0;
    var festivosTrabajados = 0;

    for (var fecha in diasMarcados) {
        var data = diasMarcados[fecha];
        if (data.tipo === 'trabajado' || data.tipo === 'baja') {
            horasTrabajadas += 8;
            diasTrabajados++;
            
            if (data.esFestivo) {
                festivosTrabajados++;
                horasRequeridas -= 4; // Ajuste por festivo trabajado
            }
        }
        if (data.tipo === 'fiesta') {
            diasFiesta++;
        }
    }

    var balance = horasTrabajadas - horasRequeridas;
    var diasBalance = balance / 8;

    document.getElementById('diasTrabajados').textContent = diasTrabajados;
    document.getElementById('diasFiesta').textContent = diasFiesta;
    document.getElementById('horasTrabajadas').textContent = horasTrabajadas + 'h';
    document.getElementById('horasRequeridas').textContent = horasRequeridas + 'h';
    document.getElementById('festivosTrabajados').textContent = festivosTrabajados;

    var balanceResult = document.getElementById('balanceResult');
    document.getElementById('balanceHoras').textContent = 
        (balance >= 0 ? '+' : '') + balance + ' horas';
    document.getElementById('balanceDias').textContent = 
        (diasBalance >= 0 ? '+' : '') + diasBalance.toFixed(1) + ' d√≠as';

    if (balance >= 0) {
        balanceResult.className = 'balance-result positive';
        document.getElementById('balanceMensaje').textContent = 
            'Has trabajado m√°s horas de las requeridas';
    } else {
        balanceResult.className = 'balance-result negative';
        document.getElementById('balanceMensaje').textContent = 
            'Te faltan horas por completar';
    }
}

// --- C√≥digo de inicializaci√≥n ---
document.getElementById('diasAnuales').addEventListener('input', calcularBalance);
document.getElementById('horasAnuales').addEventListener('input', calcularBalance);

renderCalendario();
calcularBalance();
actualizarVisualBotones(); // Lo llamamos al inicio por si acaso
</script>
<footer>
  <p>&copy; 2025 Todos los derechos reservados.</p>
  <p>Developed by <strong>Mikel Urtxegi</strong></p>
</footer>
</body>
</html>